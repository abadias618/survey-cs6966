<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<section class="container" id="Survey">
    <div class="row" id="workContent">
        <div class="col-xl-12">

            <!-- CONTENT START -->
            <div class="accordion col-12" id="hitinfo">
                
                <!-- ###### INSTRUCTIONS START ###### -->
                <div class="card">
                    <div class="card-header" id="instructionsHeading">
                        <h5 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse"
                                    data-target="#instructions" aria-expanded="true"
                                    aria-controls="instructions">
                                Instructions
                            </button>
                        </h5>
                    </div>
                    <div class="card-body">
                        <h5><b>Overview</b></h5>
                        <h2>Detailed instructions</h2>
                        <p>Hi in the next images you'll find a question and a label</p>
                        <p>Thank you!</p>
                        <h5><b>Task Description</b></h5>
                        <ol>
                            <li>First, you will be shown an <b>Image</b> and 2 <b>Question</b> about the image.</li>
                            <li>The First question has to do with a label obatined narrowing the response to only 1 word</li>
                            <li>The Second question asks a bout a label that was generated together with an 
                                explanation of whyt eh calssifier chose to asign that label (both of the parts were generated together)
                            </li>
                        </ol>
                        <h5><b>Tips</b></h5>
                        <ul>
                            <li>Try to answer teh 1st question without reading the explanation of the 2nd</li>
                            <li>The explanation of the 2nd question might not be grammatically correct, but focus on the task:
                                which is to evaluate how well did the classifier assign the label.
                            </li>
                        </ul>
                        <p><span class="problem">Let's Go!</span></p>
                    </div>
                </div>
                <!-- INSTRUCTIONS END -->


                <!-- ###### SAMPLES START ###### -->
                <div class="card" name="samples">
                    <div class="card-header" id="samplesHeading">
                        <h5 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse"
                                    data-target="#samples" aria-expanded="true"
                                    aria-controls="samples">
                                Questionnaire 
                            </button>
                        </h5>
                    </div>
                    <div class="panel">
                        <br/><br/>
                        <h5><b>#### TASK 1 ####</b></h5>
                        <div class="row" id="ex-img">
                            <div class="col-lg-8">
                                <h5><b>Image:</b></h5>
                                <img class="${filename}" src=${image_url}>
                                <p><h5><b> Question:</b> Was the image above classified correctly? </h5></p>
                            </div>
                        </div>

                        <div class="panel row">
                            <div class="prompt pl-4 col-lg-8">
                                ${wo_prediction}:
                            </div>

                            <div class="pl-4 col-lg-8 choicebox">
                                <div class="form-check">
                                    <label class="form-check-label btn btn-sm btn-outline-primary">
                                        <input class="form-check-input" type="radio"
                                               name="c1" value="0">
                                        Yes
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label btn btn-sm btn-outline-primary">
                                        <input class="form-check-input" type="radio"
                                               name="c1" value="1">
                                        No
                                    </label>
                                </div>
                            </div>
                        </div>
            
                        <div class="row panel" name="expl-1">
                            <div class="prompt pl-4 col-lg-8">
                                <h5><b><u> Explanation</u>: How is this generated classification with and explanation for the image?</b></h5>
                                ${w_prediction}
                            </div>

                            <div class="pl-4 col-lg-8 choicebox">
                                <div class="form-check">
                                    <label class="form-check-label btn btn-sm btn-outline-success">
                                        <input class="form-check-input" type="radio" name="1-e1"
                                                 value="yes">
                                        Good
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label btn btn-sm btn-outline-primary">
                                        <input class="form-check-input" type="radio" name="1-e1"
                                                 value="w_yes">
                                        Somewhat Good
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label btn btn-sm btn-outline-warning">
                                        <input class="form-check-input" type="radio" name="1-e1"
                                                value="w_no">
                                        Somewhat Bad
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label btn btn-sm btn-outline-danger">
                                        <input class="form-check-input" type="radio" name="1-e1"
                                                value="no">
                                        bad
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    
                    
                <!-- ###### SAMPLES END ###### -->

                <!--FEEDBACK START-->
                <div class="card">
                    <h5 class="card-header">Optional feedback? &nbsp; &nbsp;<a
                            data-toggle="collapse"
                            href="#feedback"
                            style="color:#0080ff;font-weight:normal;text-decoration: underline;">(expand/collapse)</a>
                    </h5>
                    <div id="feedback" class="collapse" style="margin:5px">
                        <div class="card-body">
                            <p>If anything about the HIT was unclear, please comment below. We'd like
                                to
                                make our HITs easier for future workers.
                                Note: no need to point out incorrect/missing detections here. </p>
                            <textarea class="form-control" rows="2" name="commentbox"></textarea>
                        </div>
                    </div>
                </div>
                <!--FEEDBACK END-->

                <!--SUBMIT START-->
                <div class="row mt-5">
                    <div class="col-2 offset-5">
                        <input id="submitButton" type="submit" value="Submit">
                    </div>
                </div>
                <!--SUBMIT END-->
            </div>
            <!-- CONTENT END -->
        </div>
    </div>
</section>


<link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css"
      integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B"
      crossorigin="anonymous">
<style type="text/css">

    /***********************************************
    MOSAIC BOOSTRAP OVERWRITES
    ***********************************************/
    #hitinfo .card {
        border-radius: 0;
    }
    #hitinfo .card:first-child {
        border-bottom: 0;
    }
     #hitinfo button.btn-link {
        color: #06486F;
        text-decoration: none;
     }
    #hitinfo button.btn-link:hover {
        text-decoration: none;
    }
    #hit ul.question-choice {
        list-style-type: none;
    }
    #hit #mturk_form .card {
        border: none;
        background-color: inherit;
    }
    #hit .accordion .card-header {
        background-color: #E5E5E5;
        border: none;
    }
    #hit .card {
        border: none;
    }
    /***********************************************
    MOSAIC GENERAL STYLING
    ***********************************************/
    #hit {
        background-color: rgba(0,0,0,.03);
        padding-bottom: 4rem;
    }
     body {
        font-family: "Open Sans", "Roboto", sans-serif;
        font-size: .92rem;
     }
    textarea#feedback {
        width: 100%;
        border: 1px solid #ddd;
    }
    textarea#feedback:focus {
        outline: none !important;
        border-color: #85c8ea;
    }
    input#submitButton {
        margin: auto;
        display: block;
        background-color: #2172a4;
        color: #fff;
        font-size: 1.125rem;
        padding: .5rem 1rem;
        cursor: pointer;
        border-radius: 1rem;
    }
    input#submitButton:hover {
        background-color: #06486F;
    }
    #event, div.question {
        //border-bottom: solid 1px #ccc;
    }
    .event-container h4 {
        font-size: 1.24rem;
        padding: 1rem 1.5rem;
    }
    .event {
        background-color: rgba(0,0,0,.03);
        border-radius: 1rem;
        margin-top: 25px;
        margin-bottom: 0px;
    }
    input.person {
        margin-left: 20px;
        border: none;
        background-color: white;
        text-align: left;
    }
    input.inline_blank {
        border: none;
        border-bottom: solid 1px #ccc;
        background-color: inherit;
        text-align: center;
    }
    input.inline_blank.hitbox {
        text-align: left;
    }
    input.inline_blank:focus {
        outline: none;
    }
    .optional span.obj-num, .optional span.indicator {
        color: #aaa;
    }
    span.optional {
        font-style: italic;
    }
    div.question-field-group .card-body{
        padding: 2rem 0 0;
    }
    div.example div.card-body {
        padding: 1rem 0 0;
    }
    div.form-check, div.form-check label, div.form-check input {
        cursor: pointer;
    }
    .example {
        padding: 2rem 0;
        border-bottom: solid 1px #ccc;
    }
    div.example:last-child {
        border-bottom: none;
    }
    div.question-container{
        padding: 3rem 0;
        border-bottom: solid 1px #ccc;
    }
    div.question-container:first-child{
        padding: 0 0 5rem;
    }
    li {
        margin-top: 0;
    }
    li.level1 {
        margin-top: 1rem;
    }
    #instructions li.warning {
        color: darkorange;
    }
    #instructions li.sub-warning {
        color: black;
    }
    #instructions li.good {
        color: green;
    }
    #instructions li.bad {
        color: darkred;
    }
    #instructions span.bad {
        color: darkred;
    }
    div.req-obj-container div.card-body {
        padding: 0;
    }
    div.req-obj-fields-container {
        padding-left: 0;
    }
    span.highlight {
        font-weight: bold;
        color: darkslateblue;
    }
    span.emphasize {
        font-style: italic;
        font-weight: bold;
        text-decoration: underline;
    }
    div.xneed div.card-body {
        padding: 0;
    }

    .minipad {
        padding-left: 0rem;
    }
    .questionrow {
        /*border-bottom: 1px solid gray;*/
        padding-bottom: 2px;
        margin-bottom: 4px;
        margin-left: 0;
        margin-right: -5px;
    }

    .prompt {
      font-size: 18;
    }

    .panel {
        padding: 10px;
        margin-bottom: 3px;
        margin-top: 5px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        -webkit-box-shadow: 0 1px 1px rgba(0,0,0,.05);
        box-shadow: 0 1px 1px rgba(0,0,0,.05);
        font-size: 11pt;
    }
    .table {
        margin-top: 0.2rem;
        margin-bottom: 0.2rem;
        background-color: #e6e6e633;
        border: 1px solid #ddd;
        border-radius: 4px;
        -webkit-box-shadow: 0 1px 1px rgba(0,0,0,.05);
        box-shadow: 0 1px 1px rgba(0,0,0,.05);
    }
    .table td, .table th {
        padding: 0.3rem;
    }

    .body {
        font-size:11pt;
    }

    .emph {
        background-color: #c3e6cb;
        color: #000;
        font-weight: bold;
    }

    .emph-expl {
        background-color: #FACC2E;
        color: #000;
        font-weight: bold;
    }

    .problem {
        background-color: #F5BCA9;
        color: #000;
        font-weight: bold;
    }

    .problem2 {
        background-color: #F5F6CE;
        color: #000;
        font-weight: bold;
    }

    .problem3 {
        background-color: #D8F6CE;
        color: #000;
        font-weight: bold;
    }
    div {
        margin-bottom: 0.5em;
    }
    .new {
        background-color: yellow;
        color: #000;
        font-weight: bold;
    }

    .new-latest {
        background-color: orange;
        color: #000;
        font-weight: bold;
    }

    .superemph {
        background-color: #e6a0a5;
        color: #000;
        font-weight: bold;
    }

    .deemph {
        /*background-color: #f9f9f9;*/
        color: #141414;
        /*font-weight: lighter;*/
        font-size:10pt;
    }

    .row {
        margin-right: -5px;
        margin-left:-5px;
    }
    .questionbox {
        padding-right: 1px;
        padding-left: 1px;
    }
    .choicebox{
      padding-right: 1px;
      padding-left: 1.5rem;
      margin-left: 25px;
    }
    .answerbox {
        padding-right: 1px;
        padding-left: 1px;
    }
    .input-group-text {
        padding: 3px;
        font-size: 0.8rem;
    }
    .card-header {
        padding: .25rem .5rem;
    }
    .card {
        margin-bottom: 3px;
    }
    .card-body {
        padding-top: .75rem;
        padding-bottom: 0;
    }
    .list-group-item {
        padding: .2rem .5rem;
        background-color: #e6e6e6;
    }

    .image-toggle {
        border-color: #000;
        white-space: normal;
        color: #fff;
    }

    .img-container {
      position: relative;
      display: inline-block;
    }
    .annotimage {
      display: block;
      max-width: 100%;
      height: auto;
      margin-top:0;
    }

    .drawing-class {
        height:0;
    }
    .segmentation {
      position: absolute;
      top: 0;
      left: 0;
      height:100%;
      width:100%;
    }

    .smalltxt {
        font-size:.6rem;
    }
    .form-check {
        padding-left:0;
        font-size:0.75rem;
    }
    .form-check-input {
        margin-left:0;
        position: relative;
    }

    .btn-sm {
        border-radius: .2rem;
        padding: 0.1rem 0.5rem;
        margin-bottom:0;
    }

    .container {
        padding:0;
    }
    .col-xl-12 {
        padding:0;
    }
</style>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"
        integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.5/svg.min.js"
        integrity="sha256-QvaFssiJCr71CxCZfYVWAXXGlwAqXbXerSdoW2t/Few="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.7/chroma.min.js"></script>
<script src="https://cdn.rawgit.com/internalfx/distinct-colors/3bbd4cc2/dist/distinct-colors.min.js"></script>


<script>
const FONTSIZE=20;

function getLabel(answer_box){
    for (var i=0; i<3; i++) {
        if (answer_box[i].checked == true) {
            return i
        }
    }
}

function all_ticked_check() {
    // checks that every box has been ticked
    
    var is_checked = {};
    $('.choicebox > .form-check > > input:checked').each(function() { //checks all choice boxes
        is_checked[$(this).attr('name')] = true; // confirms that "this" (current answer, see "name") is indeed checked
    });
    console.log(is_checked); // prints all the ones that are checked

    var all = {};
    $('.choicebox > .form-check > > input').each(function() { //checks all choice boxes
        all[$(this).attr('name')] = true; // confirms that "this" (current answer, see "name") is indeed checked
    });

    var is_complete = false;
    if (Object.keys(all).length == Object.keys(is_checked).length) {
        is_complete = true
    }

    return is_complete;
};


function getExpl(expl_box){
    for (var i=0; i<4; i++) {
        if (expl_box[i].checked == true) {
            return i
        }
    }
}

function all_answers_yes() {
    // Checks that not a large majority of explanations (more than 80%) have been evaluated with "Yes"

    // iterate trough answers
    var message = ""
    var yes_counter = 0
    for (var i=1; i < 11; i++) {
        var expl1_box = document.getElementsByName(i + '-e1');
        var expl2_box = document.getElementsByName(i + '-e2');
        expl1 = getExpl(expl1_box);
        expl2 = getExpl(expl2_box);
        if (expl1 == 0) {
            yes_counter++
        }
        if (expl2 == 0) {
            yes_counter++
        }
    }
    if (yes_counter>16) {        
        message = "It is very unlikely that so many answer are just 'YES'. Please re-evaluate and be more critical.";
        console.log(message);
        return [false, message];
    }
    return [true, message];
};

function shortcoming_mismatch() {
    // sets restriction on evaluation of explanations and shortcoming selection

    // iterate trough answers
    var message = ""
    var incorrect_counter = 0
    for (var i=1; i < 11; i++) {

        // get explanations
        var expl1_box = document.getElementsByName(i + '-e1');
        var expl2_box = document.getElementsByName(i + '-e2');
        expl1 = getExpl(expl1_box);
        expl2 = getExpl(expl2_box);

        // get shortcomings
        var sh1_box = document.getElementsByName(i + '-f1');
        var sh2_box = document.getElementsByName(i + '-f2');

        // if yes and not None
        if ((expl1 == 0) && (sh1_box[3].checked == false)) {
            incorrect_counter++
            message = message + "In explanation #1 of task " + i + " you selected 'YES' but selected a shortcoming. In this case, the explanation cannot be better than 'WEAK YES'. Please correct this.\n";
        }
        // if no and None
        if ((expl2 == 0) && (sh2_box[3].checked == false)) {
            incorrect_counter++
            message = message + "In explanation #2 of task " + i + " you selected 'YES' but selected a shortcoming. In this case, the explanation cannot be better than 'WEAK YES'. Please correct this.\n";
        }
        if ((expl1 > 1) && (sh1_box[3].checked == true)) {
            incorrect_counter++
            message = message + "In explanation #1 of task " + i + " you selected '(WEAK) NO' but selected no shortcoming. If the explanation doesn't justify the answer, it has to have shortcomings. Please correct this.\n";
        }
        if ((expl2 > 1) && (sh2_box[3].checked == true)) {
            incorrect_counter++
            message = message + "In explanation #2 of task " + i + " you selected '(WEAK) NO' but selected no shortcoming. If the explanation doesn't justify the answer, it has to have shortcomings. Please correct this.\n";
        }
    }
    if (incorrect_counter>0) {        
        console.log(message);
        return [false, message];
    }
    return [true, message];
};


function none_unique() {
    // restrictions on which shortcomings can be selected

    // iterate trough answers
    var message = ""
    var incorrect_counter = 0
    for (var i=1; i < 11; i++) {

        // get shortcomings
        var sh1_box = document.getElementsByName(i + '-f1');
        var sh2_box = document.getElementsByName(i + '-f2');

        if ((sh1_box[3].checked == true) && ((sh1_box[0].checked == true) || (sh1_box[1].checked == true) || (sh1_box[2].checked == true))) {
            incorrect_counter++
            message = message + "In explanation #1 of task " + i + " you selected 'None' and other options as shortcomings. This is not possible. Please correct this.\n";
        }
        if ((sh2_box[3].checked == true) && ((sh2_box[0].checked == true) || (sh2_box[1].checked == true) || (sh2_box[2].checked == true))) {
            incorrect_counter++
            message = message + "In explanation #2 of task " + i + " you selected 'None' and other options as shortcomings. This is not possible. Please correct this.\n";
        }
    }
    if (incorrect_counter>0) {        
        console.log(message);
        return [false, message];
    }
    return [true, message];
};




$( document ).ready(function() {
    $('#submitButton').on('click', function () {
        if (!all_ticked_check()) {
            alert("Not all boxes are ticked. Make sure to do this first.");
            return false;
        }
        if (!none_unique()[0]) {
            alert(none_unique()[1]);
            return false;
        }
        if (!shortcoming_mismatch()[0]) {
            alert(shortcoming_mismatch()[1]);
            return false;
        }
        if (!all_answers_yes()[0]) {
            alert(all_answers_yes()[1]);
            return false;
        }
        if (!answers_correct_check()[0]) {
            alert(answers_correct_check()[1]);
            return false;
        }
    });
});


</script>